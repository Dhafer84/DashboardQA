name: Full CI/CD Pipeline for Dashboard-QA

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  validate-html:
    name: Validate HTML
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: HTML Validator
        uses: Cyb3r-Jak3/html5validator-action@v2
        with:
          root: ./

  validate-css:
    name: Lint CSS
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install stylelint
        run: npm install stylelint stylelint-config-standard --save-dev
      - name: Run CSS Lint
        run: npx stylelint "**/*.css"

  validate-js:
    name: Lint JS
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install ESLint
        run: npm install eslint --save-dev
      - name: Run JS Lint
        run: npx eslint "**/*.js" || true

  optimize-images:
    name: Optimize PNG/JPG Images
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Optimize images
        uses: calibreapp/image-actions@v1
        with:
          compress_only: true

  minify:
    name: Minify HTML/CSS/JS
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install minifiers
        run: npm install -g html-minifier-terser clean-css-cli terser
      - name: Minify HTML
        run: |
          html-minifier-terser --collapse-whitespace --remove-comments \
          --minify-css true --minify-js true \
          -o index.min.html index.html
      - name: Minify CSS
        run: cleancss -o style.min.css style.css
      - name: Minify JS
        run: terser script.js -o script.min.js

  test-e2e:
    name: End-to-End Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Playwright
        run: |
          npm install -D @playwright/test
          npx playwright install
      - name: Run E2E tests
        run: npx playwright test

  deploy:
    name: Deploy to GitHub Pages
    needs: [validate-html, validate-css, validate-js, optimize-images, minify, test-e2e]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/upload-pages-artifact@v3
        with:
          path: ./
      - uses: actions/deploy-pages@v4

